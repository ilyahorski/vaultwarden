# Roadmap: Dungeon Crawler

## Критические исправления

### Память и производительность
- [ ] **Мемоизация и оптимизация памяти** — после часа игры и 11 уровней размер вкладки превышает 1.1 ГБ
  - Реализовать lazy-loading для `levelHistory` (хранить только текущий и соседние уровни в памяти)
  - Использовать `useMemo` и `useCallback` для тяжёлых вычислений
  - Сжимать данные уровней перед сохранением в `levelHistory`
  - Рассмотреть IndexedDB для хранения уровней вместо памяти
  - Очищать неиспользуемые данные при переходе между уровнями

### Баги генерации
- [ ] **Предметы на непроходимых клетках** — предметы могут генерироваться на факелах или лестницах
  - Добавить проверку типа клетки перед размещением предмета
  - Создать список "блокирующих" типов клеток: `torch`, `torch_lit`, `stairs_up`, `stairs_down`, `water`, `lava`

### Баги логирования
- [ ] **Дублирование логов** — некоторые сообщения в логе появляются дважды
  - При использовании зелий лог дублируется
  - При атаке врагов лог дублируется
  - Вероятно, двойной вызов `addLog` или проблема с React StrictMode (двойной рендер в dev)

---

## Архитектурные улучшения

### Роутинг и разделение режимов
- [ ] **Создание роутинга** для разделения инструментов мастера и игрока
  - `/play` — режим игрока (только игровой интерфейс)
  - `/editor` — режим мастера (полный редактор)
  - `/campaign/:id` — загрузка конкретной кампании
  - Использовать React Router или аналог

### Рефакторинг констант
- [ ] **Централизация переменных** — вынести все константы в один файл
  - Геймплейные константы (урон, XP, HP монстров)
  - UI константы (размеры, цвета)
  - Конфигурация генератора (размеры комнат, шансы)

---

## Новые механики

### Торговля
- [ ] **Торговец** — NPC для обмена золота на товары
  - Новый тип клетки: `merchant`
  - Интерфейс магазина с категориями (оружие, броня, зелья)
  - Динамические цены (зависят от редкости и уровня)
  - Возможность продажи предметов из инвентаря
  - Торговец появляется каждые 3-4 уровня или в специальных "безопасных" комнатах

### Система инвентаря
- [ ] **Улучшение работы с предметами**
  - Если найденный предмет хуже экипированного — забирать в инвентарь
  - Добавить кнопку "Продать всё ненужное" у торговца
  - Сравнение предметов при наведении (текущий vs найденный)
  - Автоматическая сортировка инвентаря по типу/редкости

---

## Предложения по улучшению (от Claude)

### Геймплей

#### Боевая система
- [ ] **Инициатива и порядок хода** — кто бьёт первым зависит от ловкости/класса
- [ ] **Критические удары** — шанс крита для всех классов (не только Разбойник)
- [ ] **Скрытые комнаты** — сейчас секрет не играет никакой роли 
- [ ] **Промахи** — небольшой шанс промаха в зависимости от брони врага
- [ ] **Эффекты статуса** — яд, кровотечение, оглушение, заморозка
- [ ] **Дальний бой** — луки/арбалеты для атаки на расстоянии

#### Исследование
- [ ] **Мини-карта** — маленькая карта всего уровня в углу экрана
- [ ] **Автокарта** — отмечать важные точки (лестницы, торговцы, боссы)
- [ ] **Интерактивные объекты** — рычаги, кнопки, разрушаемые стены

#### Прогрессия
- [ ] **Дерево навыков** — разблокировка новых способностей при левел-апе
- [ ] **Пассивные бонусы** — выбор перков каждые N уровней
- [ ] **Достижения** — награды за выполнение челленджей
- [ ] **New Game+** — повторное прохождение с сохранением части прогресса

### Редактор карт (режим Мастера)

#### Инструменты
- [ ] **Заливка области** — быстрое заполнение прямоугольной области
- [ ] **Копирование/вставка** — дублирование участков карты
- [ ] **Отмена/повтор** (Undo/Redo) — Ctrl+Z / Ctrl+Y
- [ ] **Шаблоны комнат** — готовые паттерны (арена, сокровищница, лабиринт)
- [ ] **Кисти разного размера** — 1x1, 3x3, 5x5

#### Валидация
- [ ] **Проверка проходимости** — убедиться что игрок может дойти до выхода
- [ ] **Предупреждения** — слишком много/мало врагов, отсутствует лестница
- [ ] **Тестовый запуск** — мгновенно протестировать уровень

#### Импорт/экспорт
- [ ] **Экспорт в изображение** — PNG карты для превью
- [ ] **Шаринг кампаний** — генерация ссылки для обмена
- [ ] **Библиотека кампаний** — каталог пользовательских подземелий

### Визуал и UX

#### Графика
- [ ] **Анимации** — плавные переходы, эффекты атак, смерти врагов
- [ ] **Частицы** — искры от факелов, капли воды, дым
- [ ] **Тени** — динамическое освещение от факелов
- [ ] **Спрайты вместо иконок** — пиксельная графика для атмосферы

#### Интерфейс
- [ ] **Горячие клавиши** — 1-9 для предметов, I для инвентаря, M для карты
- [ ] **Контекстное меню** — правый клик на клетке для действий
- [ ] **Тултипы** — подробная информация при наведении
- [ ] **Адаптивный дизайн** — корректное отображение на мобильных устройствах

#### Звук
- [ ] **Эмбиент** — фоновая музыка для каждой темы (склеп, пещера, инферно)
- [ ] **Звуковые эффекты** — шаги, удары, открытие дверей, подбор предметов
- [ ] **Голосовые реплики** — короткие фразы при событиях

### Мультиплеер (долгосрочно)

- [ ] **Кооператив** — 2-4 игрока исследуют подземелье вместе
- [ ] **PvP арена** — дуэли между игроками
- [ ] **Асинхронный режим** — оставлять "призраков" для других игроков
- [ ] **Таблица лидеров** — рейтинг по глубине, золоту, убийствам

---

## Технический долг

- [ ] Типизация: убрать все `any`, строгий TypeScript
- [ ] Тесты: unit-тесты для генератора, интеграционные для боевой системы
- [ ] Документация: JSDoc для ключевых функций
- [ ] Линтинг: настроить ESLint с строгими правилами

---

## Приоритеты

### Фаза 1 (Срочно)
1. Исправить баг с предметами на факелах/лестницах
2. Оптимизация памяти (критично для долгих сессий)

### Фаза 2 (Важно)
3. Торговец и продажа предметов
4. Улучшение системы инвентаря
5. Роутинг для режимов

### Фаза 3 (Улучшения)
6. Mини-карта
7. Горячие клавиши
8. Инструменты редактора (undo/redo, заливка)

### Фаза 4 (Полировка)
9. Анимации и звуки
10. Дерево навыков
11. Достижения
